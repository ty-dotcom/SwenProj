{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tyree/Codes/JS/SWEN/frontend/src/app/actions.ts"],"sourcesContent":["\"use server\";\r\nimport { clerkClient, currentUser } from \"@clerk/nextjs/server\";\r\nimport { StreamClient } from \"@stream-io/node-sdk\";\r\n\r\nexport async function getToken() {\r\n  const streamApiKey = process.env.NEXT_PUBLIC_STREAM_VIDEO_API_KEY;\r\n  const streamApiSecret = process.env.STREAM_VIDEO_API_SECRET;\r\n  if (!streamApiKey || !streamApiSecret) {\r\n    throw new Error(\"Stream API key or secret not set\");\r\n  }\r\n\r\n  const user = await currentUser();\r\n\r\n  // console.log(\"Generating token for user: \", user?.id);\r\n\r\n  if (!user) {\r\n    throw new Error(\"User not authenticated\");\r\n  }\r\n\r\n  const streamClient = new StreamClient(streamApiKey, streamApiSecret);\r\n\r\n  const expirationTime = Math.floor(Date.now() / 1000) + 60 * 60;\r\n\r\n  const issuedAt = Math.floor(Date.now() / 1000) - 60;\r\n\r\n  const token = streamClient.generateUserToken({\r\n    user_id: user.id,\r\n    exp: expirationTime,\r\n    iat: issuedAt\r\n  });\r\n\r\n  // console.log(\"Successfully generated token: \", token);\r\n\r\n  return token;\r\n}\r\n\r\nexport async function getAdminId() {\r\n  const response = await (await clerkClient()).users.getUserList({\r\n    username: [\"admin\"],\r\n  });\r\n\r\n  return response.data;\r\n}\r\n\r\nexport async function getUserIds(emailAddresses: string[]) {\r\n  const response = await (await clerkClient()).users.getUserList({\r\n    emailAddress: emailAddresses,\r\n  });\r\n  return response.data.map((user) => user.id);\r\n}"],"names":[],"mappings":";;;;;;;IAIsB,WAAA,WAAA,GAAA,IAAA,8PAAA,EAAA,8CAAA,mPAAA,EAAA,KAAA,GAAA,yPAAA,EAAA","debugId":null}},
    {"offset": {"line": 19, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tyree/Codes/JS/SWEN/frontend/src/app/ClientProvider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useUser } from \"@clerk/nextjs\";\r\nimport {\r\n  StreamVideo,\r\n  StreamVideoClient,\r\n  User,\r\n} from \"@stream-io/video-react-sdk\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { nanoid } from \"nanoid\";\r\nimport { useEffect, useLayoutEffect, useRef, useState } from \"react\";\r\nimport { getToken } from \"./actions\";\r\n\r\ninterface ClientProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function ClientProvider({ children }: ClientProviderProps) {\r\n  const videoClient = useInitializeVideoClient();\r\n\r\n  if (!videoClient) {\r\n    return (\r\n      <div className=\"flex h-screen items-center justify-center\">\r\n        <Loader2 className=\"mx-auto animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <StreamVideo client={videoClient}>{children}</StreamVideo>;\r\n}\r\n\r\nfunction useInitializeVideoClient() {\r\n  const { user, isLoaded: userLoaded } = useUser();\r\n  const ref = useRef<StreamVideoClient | null>(null)\r\n  const [videoClient, setVideoClient] = useState<StreamVideoClient | null>(\r\n    null,\r\n  );\r\n\r\n  useLayoutEffect(() => {\r\n    if (!userLoaded) return;\r\n\r\n    let streamUser: User;\r\n\r\n    if (user?.id) {\r\n      streamUser = {\r\n        id: user.id,\r\n        name: user.username || user.id,\r\n        image: user.imageUrl,\r\n      };\r\n    } else {\r\n      const id = nanoid();\r\n      streamUser = {\r\n        id,\r\n        type: \"guest\",\r\n        name: `Guest ${id}`,\r\n      };\r\n    }\r\n\r\n    const apiKey = process.env.NEXT_PUBLIC_STREAM_VIDEO_API_KEY;\r\n\r\n    if (!apiKey) {\r\n      throw new Error(\"Stream API key not set\");\r\n    }\r\n\r\n    ref.current = new StreamVideoClient({\r\n      apiKey,\r\n      user: streamUser,\r\n      tokenProvider: user?.id ? getToken : undefined,\r\n    })\r\n    \r\n    setVideoClient(ref.current);\r\n\r\n    return () => {\r\n      ref.current?.disconnectUser();\r\n      setVideoClient(null);\r\n    };\r\n  }, [user?.id, user?.username, user?.imageUrl, userLoaded]);\r\n\r\n  return videoClient;\r\n}"],"names":[],"mappings":";;;;AA0DmB;;AAxDnB;AACA;AAAA;AAKA;AACA;AACA;AACA;;;AAXA;;;;;;;AAiBe,SAAS,eAAe,EAAE,QAAQ,EAAuB;;IACtE,MAAM,cAAc;IAEpB,IAAI,CAAC,aAAa;QAChB,qBACE,yMAAC;YAAI,WAAU;sBACb,cAAA,yMAAC,+NAAO;gBAAC,WAAU;;;;;;;;;;;IAGzB;IAEA,qBAAO,yMAAC,gNAAW;QAAC,QAAQ;kBAAc;;;;;;AAC5C;GAZwB;;QACF;;;KADE;AAcxB,SAAS;;IACP,MAAM,EAAE,IAAI,EAAE,UAAU,UAAU,EAAE,GAAG,IAAA,0KAAO;IAC9C,MAAM,MAAM,IAAA,mLAAM,EAA2B;IAC7C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,qLAAQ,EAC5C;IAGF,IAAA,4LAAe;oDAAC;YACd,IAAI,CAAC,YAAY;YAEjB,IAAI;YAEJ,IAAI,MAAM,IAAI;gBACZ,aAAa;oBACX,IAAI,KAAK,EAAE;oBACX,MAAM,KAAK,QAAQ,IAAI,KAAK,EAAE;oBAC9B,OAAO,KAAK,QAAQ;gBACtB;YACF,OAAO;gBACL,MAAM,KAAK,IAAA,mLAAM;gBACjB,aAAa;oBACX;oBACA,MAAM;oBACN,MAAM,CAAC,MAAM,EAAE,IAAI;gBACrB;YACF;YAEA,MAAM;YAEN;;YAIA,IAAI,OAAO,GAAG,IAAI,2MAAiB,CAAC;gBAClC;gBACA,MAAM;gBACN,eAAe,MAAM,KAAK,6KAAQ,GAAG;YACvC;YAEA,eAAe,IAAI,OAAO;YAE1B;4DAAO;oBACL,IAAI,OAAO,EAAE;oBACb,eAAe;gBACjB;;QACF;mDAAG;QAAC,MAAM;QAAI,MAAM;QAAU,MAAM;QAAU;KAAW;IAEzD,OAAO;AACT;IAhDS;;QACgC,0KAAO","debugId":null}}]
}