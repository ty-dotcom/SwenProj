{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/tyree/Codes/JS/SWEN/frontend/src/app/ClientProvider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useUser } from \"@clerk/nextjs\";\r\nimport {\r\n  StreamVideo,\r\n  StreamVideoClient,\r\n  User,\r\n} from \"@stream-io/video-react-sdk\";\r\nimport { Loader2 } from \"lucide-react\";\r\nimport { nanoid } from \"nanoid\";\r\nimport { useEffect, useLayoutEffect, useState } from \"react\";\r\nimport { getToken } from \"./actions\";\r\n\r\ninterface ClientProviderProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport default function ClientProvider({ children }: ClientProviderProps) {\r\n  const videoClient = useInitializeVideoClient();\r\n\r\n  if (!videoClient) {\r\n    return (\r\n      <div className=\"flex h-screen items-center justify-center\">\r\n        <Loader2 className=\"mx-auto animate-spin\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <StreamVideo client={videoClient}>{children}</StreamVideo>;\r\n}\r\n\r\nfunction useInitializeVideoClient() {\r\n  const { user, isLoaded: userLoaded } = useUser();\r\n  const [videoClient, setVideoClient] = useState<StreamVideoClient | null>(\r\n    null,\r\n  );\r\n\r\n  useLayoutEffect(() => {\r\n    if (!userLoaded) return;\r\n\r\n    let streamUser: User;\r\n\r\n    if (user?.id) {\r\n      streamUser = {\r\n        id: user.id,\r\n        name: user.username || user.id,\r\n        image: user.imageUrl,\r\n      };\r\n    } else {\r\n      const id = nanoid();\r\n      streamUser = {\r\n        id,\r\n        type: \"guest\",\r\n        name: `Guest ${id}`,\r\n      };\r\n    }\r\n\r\n    const apiKey = process.env.NEXT_PUBLIC_STREAM_VIDEO_API_KEY;\r\n\r\n    if (!apiKey) {\r\n      throw new Error(\"Stream API key not set\");\r\n    }\r\n\r\n    const client = new StreamVideoClient({\r\n      apiKey,\r\n      user: streamUser,\r\n      tokenProvider: user?.id ? getToken : undefined,\r\n    });\r\n\r\n    setVideoClient(client);\r\n\r\n    return () => {\r\n      client.disconnectUser();\r\n      setVideoClient(null);\r\n    };\r\n  }, [user?.id, user?.username, user?.imageUrl, userLoaded]);\r\n\r\n  return videoClient;\r\n}"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAKA;AACA;AACA;;;;;;AAVA;;;;;;;;AAiBe,SAAS,eAAe,EAAE,QAAQ,EAAuB;IACtE,MAAM,cAAc;IAEpB,IAAI,CAAC,aAAa;QAChB,qBACE,0PAAC;YAAI,WAAU;sBACb,cAAA,0PAAC,4NAAO;gBAAC,WAAU;;;;;;;;;;;IAGzB;IAEA,qBAAO,0PAAC,6MAAW;QAAC,QAAQ;kBAAc;;;;;;AAC5C;AAEA,SAAS;IACP,MAAM,EAAE,IAAI,EAAE,UAAU,UAAU,EAAE,GAAG,IAAA,uKAAO;IAC9C,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,6NAAQ,EAC5C;IAGF,IAAA,oOAAe,EAAC;QACd,IAAI,CAAC,YAAY;QAEjB,IAAI;QAEJ,IAAI,MAAM,IAAI;YACZ,aAAa;gBACX,IAAI,KAAK,EAAE;gBACX,MAAM,KAAK,QAAQ,IAAI,KAAK,EAAE;gBAC9B,OAAO,KAAK,QAAQ;YACtB;QACF,OAAO;YACL,MAAM,KAAK,IAAA,qKAAM;YACjB,aAAa;gBACX;gBACA,MAAM;gBACN,MAAM,CAAC,MAAM,EAAE,IAAI;YACrB;QACF;QAEA,MAAM;QAEN;;QAIA,MAAM,SAAS,IAAI,6LAAiB,CAAC;YACnC;YACA,MAAM;YACN,eAAe,MAAM,KAAK,WAAW;QACvC;QAEA,eAAe;QAEf,OAAO;YACL,OAAO,cAAc;YACrB,eAAe;QACjB;IACF,GAAG;QAAC,MAAM;QAAI,MAAM;QAAU,MAAM;QAAU;KAAW;IAEzD,OAAO;AACT","debugId":null}}]
}